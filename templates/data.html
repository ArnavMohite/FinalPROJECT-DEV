<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“Š EventXpert | Data Visualization</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <header class="site-header">
    <div class="brand">ğŸ  EventXpert</div>
    <nav class="nav">
      <a href="{{ url_for('index') }}">Home</a>
      <a href="{{ url_for('data_page') }}" class="active">Data Visualization</a>
      <a href="{{ url_for('index') }}">Manage Events</a>
      <a href="{{ url_for('api_page') }}">Live Sports API</a>
      <a href="{{ url_for('about') }}">About Us</a>
    </nav>
  </header>

  <main class="charts fade-in" style="max-width:1000px; margin:auto;">
    <h2 class="section-title">ğŸ“Š Event Insights Dashboard</h2>
    <p style="text-align:center;">Visualizing live data from your EventXpert database and default dataset.</p>

    <!-- Bar Chart -->
    <div class="chart-container">
      <h3>Average Ticket Price by Team</h3>
      <canvas id="barChart"></canvas>
    </div>

    <!-- Pie Chart -->
    <div class="chart-container">
      <h3>Event Distribution by Venue</h3>
      <canvas id="pieChart"></canvas>
    </div>

    <!-- Line Chart -->
    <div class="chart-container">
      <h3>Ticket Prices Over Time</h3>
      <canvas id="lineChart"></canvas>
    </div>
  </main>

  <footer class="site-footer">
    <p>Â© 2025 ğŸ  EventXpert â€¢ ISM6225 | University of South Florida</p>
  </footer>

  <script>
    // Safely pass Python (Flask) data to JavaScript
    const avgPriceData = JSON.parse(`{{ avg_price_data | tojson | safe }}`);
    const venueCounts = JSON.parse(`{{ venue_counts | tojson | safe }}`);
    const datePricePairs = JSON.parse(`{{ date_price_pairs | tojson | safe }}`);

    // --- Bar Chart ---
    new Chart(document.getElementById('barChart'), {
      type: 'bar',
      data: {
        labels: Object.keys(avgPriceData),
        datasets: [{
          label: 'Avg Price ($)',
          data: Object.values(avgPriceData),
          backgroundColor: '#006747'
        }]
      },
      options: { scales: { y: { beginAtZero: true } } }
    });

    // --- Pie Chart ---
    new Chart(document.getElementById('pieChart'), {
      type: 'pie',
      data: {
        labels: Object.keys(venueCounts),
        datasets: [{
          data: Object.values(venueCounts),
          backgroundColor: ['#006747','#b21e1e','#0060d0','#009b3a','#444']
        }]
      }
    });

    // --- Line Chart ---
    new Chart(document.getElementById('lineChart'), {
      type: 'line',
      data: {
        labels: datePricePairs.map(d => d[0]),
        datasets: [{
          data: datePricePairs.map(d => d[1]),
          borderColor: '#006747',
          backgroundColor: '#b2d8c2',
          tension: 0.3,
          fill: false
        }]
      },
      options: { plugins: { legend: { display: false } } }
    });
  </script>
</body>
</html>